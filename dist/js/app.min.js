var $map=$("#map-canvas"),mapOptions={center:{lat:-34.397,lng:150.644}},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),viewModel=function(){var e=this;e.clearMarkers=function(){e.listView().forEach(function(e){e.marker.setMap(null)})},e.fitAllMarkers=function(e){Offline.check();var o=new google.maps.LatLngBounds;if(e.length>0){for(i=0;i<e.length;i++)o.extend(e[i].marker.getPosition());map.fitBounds(o)}},e.filterText=ko.observable(""),e.listNames=ko.observableArray([]),e.autocompleteAllowed=ko.observable(!1),e.acToggleDisplay=ko.computed(function(){return ko.observable(e.autocompleteAllowed()?"AutoComplete Enabled":"AutoComplete Disabled")}),e.location=ko.observable("4940 W Rosebay Dr, Tucson, AZ"),e.itemSearch=ko.observable("drinks"),e.searchTerm=ko.observable("Burger"),e.listView=ko.observableArray([]),e.acButton=ko.pureComputed(function(){return e.autocompleteAllowed()?"btn-default":"btn-disabled"}),e.toggleAutoComplete=function(){e.autocompleteAllowed()?(e.autocompleteAllowed(!1),$("#filter").attr("autocomplete","off"),$("#filter").hide(),$("#acDisabledFilter").show()):(e.autocompleteAllowed(!0),$("#filter").autocomplete({source:e.listNames()}),$("#filter").show(),$("#acDisabledFilter").hide()),$(".ui-helper-hidden-accessible").hide()},e.filteredResults=ko.computed(function(){e.clearMarkers();var o=e.filterText().toLowerCase();if(o){var t=ko.utils.arrayFilter(e.listView(),function(e){return stringContains(e.name.toLowerCase(),o)?(e.marker&&e.marker.setMap(map),!0):!1});return e.fitAllMarkers(t),t}return e.listView().forEach(function(e){e.marker.setMap(map)}),e.fitAllMarkers(e.listView()),e.listView()},e),e.update=function(){e.clearMarkers();var o="https://api.foursquare.com/v2/venues/search?near="+e.location()+"&section="+e.itemSearch()+"&oauth_token=NOFWGL5PTP4HRY3W1IODQGUKIAG1GA5BV2AOBVGGLJGV0HF4&v=20150318";$.ajax({url:o,dataType:"json",error:function(e){Offline.check()},success:function(o){e.listView([]),updateLocation(e.location()),map.setOptions({zoom:14}),console.log(o.response);var t=o.response.venues.slice(1,-1);t.forEach(function(o){var a="undefined"==typeof o.contact.formattedPhone?"No Contact Information":o.contact.formattedPhone,n="undefined"==typeof o.contact.facebookName?"None":o.contact.facebookName,i="undefined"==typeof o.stats.usersCount?"No User Information":o.stats.usersCount,r="undefined"==typeof o.url?"No Website":'<a href="'+o.url+'">Website</a>',l=o.hereNow.summary,s=wikiAjaxCall(o);o.img=getStreetViewImage(o);var c='<h2 id="firstHeading" class="firstHeading">'+o.name+'</h2><div id="bodyContent">'+o.img+"<p>"+l+"</p><p><em>"+a+"</em></p><p>Facebook name: "+n+"</p><p>"+r+"</p><p>Number of Users: <strong>"+i+"</strong></p>"+s+"</div>",m=(new google.maps.LatLng(o.location.lat,o.location.lng),new google.maps.InfoWindow({content:c,size:new google.maps.Size(100,50)})),u=new google.maps.Marker({position:o.location,map:map,title:o.name});o.marker=u,o.infowindow=m,o.show=function(){google.maps.event.trigger(o.marker,"click")},o.toggleBounce=function(){null!==o.marker.getAnimation()?o.marker.setAnimation(null):(t.forEach(function(e){e.marker.setAnimation(null),e.infowindow.close()}),o.infowindow.open(map,o.marker),o.marker.setAnimation(google.maps.Animation.BOUNCE))},google.maps.event.addListener(o.marker,"click",function(){map.setCenter(map.setCenter(o.marker.getPosition())),o.toggleBounce()}),e.listNames.push(o.name)}),e.listView(t)}}),e.fitAllMarkers(e.listView())}};vm=new viewModel,ko.applyBindings(vm),vm.update();