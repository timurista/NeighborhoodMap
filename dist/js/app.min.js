var $map=$("#map-canvas"),mapOptions={center:{lat:-34.397,lng:150.644}},map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions),viewModel=function(){var e=this;e.selectedVenue=ko.observable({name:"none",contact:{},url:"",stats:{usersCount:0},wikiList:["none"],image_url:"#",rating:"",rating_img_url_small:"",snippet_text:""}),e.showHide=function(e,t){var o="glyphicon-minus",i="glyphicon-plus",a=$(t.currentTarget).find(".glyphicon");a.hasClass(o)?$(t.currentTarget).siblings().slideUp():$(t.currentTarget).siblings().slideDown(),a.toggleClass(i),a.toggleClass(o)},e.iconBase="https://maps.google.com/mapfiles/kml/pushpin/",e.resetIcons=function(){e.listView().forEach(function(t){t.marker.icon=e.iconBase+"red-pushpin.png"})},e.clearMarkers=function(){e.listView().forEach(function(e){e.marker.setMap(null)})},e.fitAllMarkers=function(e){Offline.check();var t=new google.maps.LatLngBounds;if(e.length>0){for(i=0;i<e.length;i++)t.extend(e[i].marker.getPosition());map.fitBounds(t)}},e.filterText=ko.observable(""),e.listNames=ko.observableArray(),e.autocompleteAllowed=ko.observable(!1),e.acToggleDisplay=ko.computed(function(){return ko.observable(e.autocompleteAllowed()?"AutoComplete Enabled":"AutoComplete Disabled")}),e.location=ko.observable("4940 W Rosebay Dr, Tucson, AZ"),e.itemSearch=ko.observable("drinks"),e.listView=ko.observableArray([]),e.acButton=ko.pureComputed(function(){return e.autocompleteAllowed()?"btn-default":"btn-disabled"}),e.toggleAutoComplete=function(){e.autocompleteAllowed()?(e.autocompleteAllowed(!1),$("#filter").attr("autocomplete","off"),$("#filter").hide(),$("#acDisabledFilter").show()):(e.autocompleteAllowed(!0),$("#filter").autocomplete({source:e.listNames()}),$("#filter").show(),$("#acDisabledFilter").hide()),$(".ui-helper-hidden-accessible").hide()},e.filteredResults=ko.computed(function(){e.clearMarkers();var t=e.filterText().toLowerCase();if(t){var o=ko.utils.arrayFilter(e.listView(),function(e){return stringContains(e.name.toLowerCase(),t)?(e.marker&&e.marker.setMap(map),!0):!1});return e.fitAllMarkers(o),o}return e.listView().forEach(function(e){e.marker.setMap(map)}),e.fitAllMarkers(e.listView()),e.listView()},e),e.update=function(){e.clearMarkers();var t="https://api.foursquare.com/v2/venues/search?near="+e.location()+"&section="+e.itemSearch()+"&oauth_token=NOFWGL5PTP4HRY3W1IODQGUKIAG1GA5BV2AOBVGGLJGV0HF4&v=20150318";$.ajax({url:t,dataType:"json",error:function(e){Offline.check()},success:function(t){e.listView([]),updateLocation(e.location()),map.setOptions({zoom:14});var o=t.response.venues.slice(1,-1);console.log("veneus from FourSqaure loaded:",o),o.forEach(function(t){t.rating="",t.rating_img_url="",t.snippet_text="",t.url="undefined"==typeof t.url?"":t.url,t.wikiList=ko.observableArray(),wikiAjaxCall(t),t.image_url=getStreetViewImage(t),t=setMarkerOptions(e,t,t.location),e.listNames.push(t.name),e.listView.push(t)})}}).fail(function(e){toastr.error("The place you entered cannot be found")}),yelpAjaxCall(e.itemSearch(),e.location(),function(t){console.log("businesses loaded:",t.businesses),t.businesses.forEach(function(t){var o=containsObjectWithName(e.listView(),t.name);if(o>-1)e.listView()[o].url=t.url,e.listView()[o].rating=t.rating,e.listView()[o].rating_img_url=t.rating_img_url,e.listView()[o].snippet_text=t.snippet_text;else{t.contact={},t.contact.formattedPhone=t.display_phone,t.contact.facebookName=t.name,t.stats={},t.stats.usersCount=t.review_count,t.url="undefined"==typeof t.url?"#":t.url,t.wikiList=ko.observableArray(),wikiAjaxCall(t);var i=new google.maps.LatLng(t.location.coordinate.latitude,t.location.coordinate.longitude);t=setMarkerOptions(e,t,i),e.listNames.push(t.name)}e.listView.push(t)})}),e.fitAllMarkers(e.listView())}};vm=new viewModel,ko.applyBindings(vm),vm.update();